
@model IEnumerable<StudentManagementSystem.Web.Models.ExamResultDisplayViewModel>

@{
    ViewData["Title"] = "Exam Results List";
}

<h2>Exam Results</h2>

<form method="get" id="searchForm" class="mb-3">
    <div class="row g-2">
        <div class="col-md-4">
            <input type="text" id="searchInput" name="query" class="form-control" placeholder="Search by student name..." value="@ViewBag.SearchString" />
        </div>
        <div class="col-md-4">
            <select asp-items="ViewBag.Courses" name="courseId" class="form-select">
                <option value="">Select a Course</option>
            </select>
        </div>
        <div class="col-md-4">
            <select name="sortOrder" class="form-select">
                <option value="">Sort by Marks</option>
                <option value="asc" selected="@(ViewBag.SortOrder == "asc" ? "selected" : null)">Ascending</option>
                <option value="desc" selected="@(ViewBag.SortOrder == "desc" ? "selected" : null)">Descending</option>
            </select>
        </div>
        <div class="col-md-1">
            <button type="submit" class="btn btn-primary w-100">Filter</button>
        </div>
    </div>
</form>

<div id="examResultsTable">
    @await Html.PartialAsync("_ExamResultsTable", Model)
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            
            function performSearch() {
                var query = $('#searchInput').val();
                var courseId = $('select[name="courseId"]').val();
                var sortOrder = $('select[name="sortOrder"]').val();

               
                 $.ajax({
                    url: '@Url.Action("Search", "ExamResult")',
                    method: 'GET',
                    data: { query: query, courseId: courseId, sortOrder: sortOrder },
                    success: function (response) {
                        debugger;
                        $('#examResultsTable').html(response);
                    },
                    error: function (xhr) {
                        $('#examResultsTable').html('<div class="alert alert-danger">Error fetching results. Please try again.</div>');
                    }
                });
            }

           
            $('#searchInput').on('keyup', function () {
                performSearch();
            });

            
            $('#searchForm').on('submit', function (e) {
                e.preventDefault(); 
                performSearch();
            });
        });
    </script>
}